!function(a){a.engine=function(b,c){var d={strConfigurationPath:"application/config/config.json",strDefaultSkin:"light",objSkins:{dark:"application/styles/skin_dark.css",light:"application/styles/skin_white.css"},strSkinKey:"mode",strConfigKey:"config",strViewsPath:"application/appviews/",strControllersPath:"application/appcontrollers/",strPageTitle:"Untitled",strNotificationFeedPath:"application/data/notification_feed.json",strAppMode:"web",objAppServerURL:{DEV:"http://dev.cst.akamai.com",PROD:"http://localhost/prod"},boolAuthEnabled:!0,boolShowBackButton:!0},e=this;e.settings={};var f=a(b),g="5.00.03.2015",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u="",v="",w="",x="",y="",z=new Object,A=new Object,B=new Object,C=new Object,D=new Object,E=new Object,F=!1,G=!1,H=!0,I=!1,J=!1,K=0,L=1;e.init=function(){ia("Plugin loaded"),e.settings=a.extend({},d,c),aa(!0),M()},e.getCurrentPage=function(){return p=$(),ia("fn > getCurrentPage "+p),p},e.getFrameworkVersion=function(){return g},e.getNavigationConfig=function(){var b={},c=f.find("#navigation-wrapper").parent().attr("id"),d=c.split("-")[0];e&&(e.length=0);var e=[];return a.each(A,function(a,b){1==b.showInNavigation&&e.push(b.pageName)}),b.navigationType=d,b.navigationList=e,b},e.setLocalStorage=function(a,b){"undefined"!=typeof window.localStorage?localStorage.setItem(a,b):f.log("setLocalStorage > ERROR: Unable to set Local Storage")},e.deleteLocalStorageItem=function(a){"undefined"!=typeof window.localStorage?(localStorage.removeItem(_id),f.log("deleteLocalStorageItem > Deleted Item: "+a)):f.log("deleteLocalStorageItem > ERROR: "+a)},e.getLocalStorage=function(a){return"undefined"!=typeof window.localStorage&&(q=localStorage.getItem(a)),q},e.clearLocalStorage=function(){localStorage.clear()},e.log=function(a){ia(a)},e.getQuerystringParam=function(a){return ja(a)},e.toggleViewLoader=function(a,b,c){ba(a,b,c)},e.toggleUIMessages=function(a,b,c,d,e){ca(a,b,c,d,e)},e.toggleMessageBox=function(a,b,c,d,e){da(a,b,c,d,e)},e.toggleStatusMessages=function(a,b,c,d){ea(a,b,c,d)},e.loadJSON=function(b){return a.getJSON(b)},e.makeAJAXRequest=function(b,c,d,e,f,g,h,i,j){var k=a.ajax({url:b,type:c,data:d,contentType:e,dataType:f,context:g,processData:h,cache:!0});k.done(i),k.fail(j)},e.cleanupPage=function(){Y()},e.getApplicationName=function(){return r},e.getApplicationVersion=function(){return s},e.getApplicationAuthor=function(){return t},e.getCurrentPageTitle=function(){return u},e.getCurrentPageSubTitle=function(){return v},e.getUserIsLoggedIn=function(){return I=e.getLocalStorage("isLoggedIn")},e.setUserIsLoggedIn=function(a){e.setLocalStorage("isLoggedIn",a)},e.getApplicationEnvironment=function(){return w},e.setApplicationEnvironment=function(a){X(D[a])},e.setContent=function(a,b){if("undefined"==typeof b&&(b=""),p==a)R(a);else if(""!==b)window.open("#!"+a.toUpperCase(),b);else{var c=window.location.origin+window.location.pathname+"#!"+a.toUpperCase();window.location=c}},e.getJSONObj=function(a,b){var c=_(a,b);return c},e.setApplicationMode=function(a){y=a},e.getApplicationMode=function(){return y};var M=function(){var b=e.settings.strPageTitle;h=e.settings.strConfigurationPath,i=e.settings.strDefaultSkin,z=e.settings.objSkins,j=e.settings.strSkinKey,k=e.settings.strConfigKey,l=e.settings.strViewsPath,m=e.settings.strControllersPath,D=e.settings.objAppServerURL,H=e.settings.boolShowBackButton,x=e.settings.strNotificationFeedPath,y=e.settings.strAppMode,a("head").find("title").html(b),N()},N=function(){var b="",c="";j?(b=ja(j),b?a.each(z,function(a,d){b==a&&(c=d)}):i&&(c=z[i])):i&&(c=z[i]),c?(a("head").append('<link href="'+c+'" rel="stylesheet">'),ia("fn > setSkin - skin: "+c)):ia("Mode and Default Skin has not been specified or is unavailable"),O()},O=function(){var a="",b="";k?(a=ja(k),b=a?a:h):b=h,e.loadJSON(b).done(function(a){var c=a.application;ia("fn > setConfiguration - config: "+b),P(c)}).fail(function(a,b,c){ia("Error loading config: "+b+", "+c),fa()})},P=function(a){r=a.name,s=a.version,t=a.author,r?(A=_(a,"pages"),C=_(a,"libraries"),Q()):ia("The Application name has not been defined in config JSON file")},Q=function(){var b=0,c=a.ajaxSettings.cache;a.ajaxSettings.cache=!0,a.each(C,function(c,d){try{switch(d.type){case"javascript":a("body").append('<script type="text/javascript" src="'+d.libpath+"?v="+d.fileVersion+'"></script>'),0!==a('script[src*="'+d.libpath+'"]').length?(b++,ia(" fn > loadLibraries - Loaded > "+d.libpath)):ia(" fn > loadLibraries - Not Loaded > "+d.libpath);break;case"css":a("head").append('<link rel="stylesheet" type="text/css" href="'+d.libpath+"?v="+d.fileVersion+'"/>'),b++,ia(" fn > loadLibraries > "+d.libpath)}}catch(e){ia(" fn > loadLibraries - Exception: "+e)}}),a.ajaxSettings.cache=c,G=!0,b===C.length&&R()},R=function(b){if("undefined"==typeof b?(b="",p=$()):p=p,null===p){var c=A[0].pageName;e.setContent(c)}Y();var d=1;ia(" > fn > setupPage - Page: "+p),p?a.each(A,function(a,b){var c=b.pageName;c==p?(B=b,u=b.pageTitle,v=b.pageSubTitle,n=b.pageController,o=b.pageControllerVersion,S(f,B,"componentList")):(d==A.length&&fa(),d++)}):0==p&&(ia(" > fn > setupPage - Page: "+p),fa())},S=function(b,c,d){ia("fn > addWrappers > "+d);var e=_(c,d);0!=e.length?(K=e.length,a.each(e,function(c,d){var e=d.view,f=e+"-wrapper",g=d.wrapper,h=d.column,i=d.fileVersion;switch(g||(g="container"),h){case"sidebar":b.append('<div id="sidebar-wrapper" class="col-xs-12 col-sm-3 col-md-3 col-lg-3"></div>'),a("#"+h+"-wrapper").append('<div class="'+g+'" id="'+f+'"></div>');break;case"content":b.append('<div id="content-wrapper" class="col-xs-12 col-sm-9 col-md-9 col-lg-9"></div>'),a("#"+h+"-wrapper").append('<div class="'+g+'" id="'+f+'"></div>');break;case"page":a("#"+h+"-wrapper").append('<div class="'+g+'" id="'+f+'"></div>')}T(f,i)})):fa()},T=function(b,c){ia(" fn > addComponents > "+b);var d=a("#"+b),e=b.split("-")[0],f=l+e+".html";E[b]=f,ga(d,f,c)},U=function(){if(""!==n){var b=m+n;ia(" fn > addControllers > "+b);try{F||(f.append('<script type="text/javascript" src="'+b+".js?v="+o+'"></script>'),aa(!1))}catch(c){ia("fn > addControllers - Exception: "+c)}}a.event.trigger({type:"HASH_CHANGE"}),V(),J||ha()},V=function(){var b='<div class="scroll-button small-heading pull-right init-hide" data-role="scrollButton" style="cursor:pointer"><i class="fa fa-chevron-up darkgrey-text"></i>',c=120;H&&(f.append(b),W(),a(window).scroll(function(){a(this).scrollTop()>c?f.find("div[data-role=scrollButton]").fadeIn(500):f.find("div[data-role=scrollButton]").fadeOut(500)}))},W=function(){var b=f.find("div[data-role=scrollButton]");b.on("click",function(){return event.preventDefault(),a(Z()).animate({scrollTop:0},200),!1})},X=function(a){w=a,ia(" fn > setAppEnvironment > "+w)},Y=function(){ia("fn > cleanPage  - Cleaning page.. "),f.find("div").remove(),f.find("script").remove(),G=!1,F=!1},Z=function(){var b=a("body"),c=b.scrollTop;return b.scrollTop++,b.scrollTop===c?document.documentElement:(b.scrollTop--,b)},$=function(){var a=window.location.href.match(/#(.)(.*)$/);return ia("fn > getHashURL - Found HashURL"),a&&"!"==a[1]&&a[2].replace(/^\//,"")},_=function(a,b){var c=a[b];return c},aa=function(a){a?f.prepend('<div id="loader" class="page-block"><div class="loader-ui"><img src="skin/images/ajax-loader2.gif" />&nbsp;Loading</div></div>'):f.find("#loader").remove()},ba=function(a,b,c){a?f.prepend('<div id="viewloader" class="page-block"><div class="views-loader"><img src="skin/images/ajax-loader2.gif" />&nbsp;'+b+"</div></div>"):f.find("#viewloader").remove()},ca=function(a,b,c,d,e){a?(f.find(c).prepend('<div class="message-ui" style="width:'+d+"%;height:"+e+'px">'+b+"</div>"),f.find(c).fadeTo("slow",.45)):(f.find(c).fadeTo("fast",1),f.find(c).find(".message-ui").remove())},da=function(a,b,c,d,e){a?f.find(c).prepend('<div class="messagebox-ui" style="width:'+d+";height:"+e+'">'+b+"</div>"):f.find(c).find(".message-ui").remove()},ea=function(a,b,c,d){c="undefined"==typeof c?"":c,d="undefined"==typeof d?"":d,a?(b.show(),b.html(c),"error"==d?(b.removeClass("status-msg-success"),b.addClass("status-msg-error")):(b.removeClass("status-msg-error"),b.addClass("status-msg-success"))):(b.hide(),b.html(""))},fa=function(){Y();var a=l+"failover.html";ga(f,a),aa(!1)},ga=function(a,b,c){"undefined"==typeof _strController&&(_strController=""),a.load(b+"?v="+c,function(a,c,d){switch(c){case"success":ia(" fn > loadPage - Comp > "+b),K==L?(U(),L=1):L++;break;case"error":ia(" fn > loadPage - Error "+b),window.location.href="#!ERROR",boolPageLoaded=!1}})},ha=function(){function b(){e.makeAJAXRequest(x+"?dt="+Math.round((new Date).getTime()/1e3),"GET",{},"application/json","json",{},!0,c,g)}function c(b){var c=b.application.notifications,e=moment().format("YYYY MM DD"),f=[];a.each(c,function(a,b){b.date===e.toString()?f.push(b):ia(" fn > displayPrimaryNotification - Notify: No other messages for the day: "+e)}),f.length>0&&d(f)}function d(b){$main_heading=a('<h4 class="blue-text">').html("Notifications"),$close_btn=a('<button class="button tiny pull-right" style="color: black;"').text("DISMISS"),$notifications_container=a('<div id="notifications_container" class="notifications_container">'),f.append(a('<div id="notifications_dialog">').attr("class","page-block")),f.find("#notifications_dialog").prepend(a("<div>").attr("class","notifications-view")),$notifications_container.appendTo(".notifications-view"),$notifications_list=a('<ul id="notifications_list" class="list-group">').appendTo($notifications_container),a.each(b,function(b,c){a('<li class="list-group-item-dark">').append(a("<div>").html('<label class="label label-'+c.type+'">'+c.name.toUpperCase()+"<label>"),a('<div class="notification-msg">').html(c.message)).appendTo("#notifications_list")}),$close_btn.appendTo(".notifications-view"),$main_heading.prependTo(".notifications-view"),a("#notifications_container").slimScroll({size:"5px",height:"320px",position:"right",color:"#666",alwaysVisible:!1,distance:"1px",railVisible:!0,railColor:"#222",railOpacity:.3,wheelStep:10,allowPageScroll:!1,disableFadeOut:!1}),$close_btn.on("click",function(b){a("#notifications_dialog").hide()})}function g(a,b,c){ia(" fn > displayPrimaryNotification - error: Error loading feed "+c)}""!==x?(ia(" fn > displayPrimaryNotification - status: "+x),b(),J=!0):ia(" fn > displayPrimaryNotification - status: No notification feeds")},ia=function(a){console.log("** ENGINE UX > "+a)},ja=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))};a(window).on("hashchange",function(){p=$(),R()}),e.init()},a.fn.engine=function(b){return this.each(function(){if(void 0==a(this).data("engine")){var c=new a.engine(this,b);a(this).data("engine",c)}})}}(jQuery);
